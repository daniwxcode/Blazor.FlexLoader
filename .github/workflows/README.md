# ?? GitHub Actions Workflows

Ce dossier contient les workflows GitHub Actions pour automatiser la CI/CD du projet Blazor.FlexLoader.

---

## ?? Workflows Disponibles

### 1?? `nuget-publish.yml` ? (PRINCIPAL)

**Nom** : ?? Build and Publish NuGet Package

**Déclencheur** :
- Automatique : Push d'un tag au format `v*.*.*` (ex: `v1.7.0`)
- Manuel : Via l'interface GitHub Actions

**Objectif** : Publier le package NuGet sur NuGet.org

**Jobs** :
1. **Build & Test** : Compile le projet et exécute les tests
2. **Publish to NuGet** : Crée et publie le package sur NuGet.org + GitHub Release

**Utilisation** :
```bash
# Créer et pousser un tag
git tag v1.7.0
git push origin v1.7.0

# Le workflow se déclenche automatiquement
```

**Exécution manuelle** :
1. Aller sur **Actions ? ?? Build and Publish NuGet Package**
2. Cliquer sur **Run workflow**
3. Sélectionner la branche `main`
4. (Optionnel) Spécifier une version custom
5. Cliquer sur **Run workflow**

---

### 2?? `ci.yml` ?

**Nom** : CI

**Déclencheur** :
- Push vers `main` ou `develop`
- Pull Request vers `main` ou `develop`

**Objectif** : Valider le code à chaque modification

**Jobs** :
1. **Build & Validate** : Compile, teste et crée un package de test
2. **Code Quality** : Vérifie le formatage et analyse le code
3. **Documentation** : Vérifie la présence des fichiers de documentation obligatoires

**Fichiers vérifiés** :
- `README.md`
- `CHANGELOG.md`
- `LICENSE`
- `docs/LoaderService-Documentation.md`

---

### 3?? `publish.yml` ?? (DÉPRÉCIÉ)

**Nom** : Publish to NuGet (DEPRECATED)

**Statut** : ? Désactivé

**Raison** : Causait des conflits avec `nuget-publish.yml` en publiant automatiquement sur chaque push vers `main`

**Déclencheur actuel** : Uniquement manuel (`workflow_dispatch`)

**Note** : Ne plus utiliser ce workflow. Utilisez `nuget-publish.yml` à la place.

---

### 4?? `dependency-update.yml` ??

**Nom** : Dependency Update

**Déclencheur** :
- Planifié : Tous les lundis à 9h (UTC)
- Manuel : Via l'interface GitHub Actions

**Objectif** : Mettre à jour automatiquement les dépendances NuGet

**Jobs** :
1. Vérifier les mises à jour disponibles
2. Mettre à jour les packages
3. Créer une Pull Request avec les changements

---

## ?? Secrets Requis

Configurer dans **Settings ? Secrets and variables ? Actions** :

| Secret | Description | Requis pour |
|--------|-------------|-------------|
| `NUGET_API_KEY` | Clé API de NuGet.org | `nuget-publish.yml` |
| `GITHUB_TOKEN` | Token GitHub (auto-généré) | Tous les workflows |

**Comment obtenir `NUGET_API_KEY`** :
1. Se connecter sur [NuGet.org](https://www.nuget.org)
2. Aller dans **Account Settings ? API Keys**
3. Créer une nouvelle clé avec :
   - **Nom** : Blazor.FlexLoader GitHub Actions
   - **Type** : Push
   - **Packages** : Sélectionner `Blazor.FlexLoader`
   - **Expiration** : 365 jours
4. Copier la clé et l'ajouter dans GitHub Secrets

---

## ?? Workflow de Publication Recommandé

```
???????????????????????????????????????????????????????
? 1. Développement sur 'develop'         ?
?    - Développer les fonctionnalités         ?
?    - Mettre à jour CHANGELOG.md ?
?    - Le workflow 'ci.yml' valide à chaque push      ?
???????????????????????????????????????????????????????
         ?
???????????????????????????????????????????????????????
? 2. Préparation de la Release  ?
?    - Mettre à jour la version dans .csproj          ?
?    - Commit: "chore(release): bump version to X.Y.Z"?
?    - Push vers 'develop'          ?
???????????????????????????????????????????????????????
                  ?
???????????????????????????????????????????????????????
? 3. Merge vers 'main'    ?
?    - git checkout main         ?
?    - git merge develop    ?
?    - git push origin main               ?
???????????????????????????????????????????????????????
           ?
???????????????????????????????????????????????????????
? 4. Création du Tag                     ?
?    - git tag vX.Y.Z ?
?    - git push origin vX.Y.Z   ?
???????????????????????????????????????????????????????
       ?
???????????????????????????????????????????????????????
? 5. Workflow 'nuget-publish.yml' s'exécute           ?
?    ? Build & Test       ?
?    ? Publish to NuGet.org         ?
?    ? Create GitHub Release     ?
???????????????????????????????????????????????????????
```

**Utiliser le script automatisé** :
```powershell
.\release.ps1 -Version 1.7.0 -ReleaseNotes "Nouvelles fonctionnalités"
```

---

## ?? Dépannage

### Le workflow ne se déclenche pas

```bash
# Vérifier que le tag est bien formaté (vX.Y.Z)
git tag -l

# Vérifier que le tag a été poussé
git ls-remote --tags origin

# Relancer manuellement le workflow
# GitHub ? Actions ? Run workflow
```

### Erreur de build

```bash
# Tester localement
dotnet restore
dotnet build --configuration Release
dotnet pack --configuration Release
```

### Package non publié sur NuGet.org

1. Vérifier les logs du workflow
2. Vérifier que `NUGET_API_KEY` est configuré
3. Vérifier que la clé n'est pas expirée
4. Attendre 5-10 minutes (délai de propagation)

---

## ?? Status des Workflows

| Workflow | Status | Utilisation |
|----------|--------|-------------|
| `nuget-publish.yml` | ? Actif | Production |
| `ci.yml` | ? Actif | Validation |
| `dependency-update.yml` | ? Actif | Maintenance |
| `publish.yml` | ? Déprécié | N/A |

---

## ?? Ressources

- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [DEPLOYMENT_GUIDE.md](../DEPLOYMENT_GUIDE.md) - Guide complet de déploiement
- [DEPLOYMENT_FIX.md](../DEPLOYMENT_FIX.md) - Explication de la correction du problème de déploiement
- [release.ps1](../release.ps1) - Script de release automatisé

---

**Dernière mise à jour** : 2024
**Mainteneur** : daniwxcode
